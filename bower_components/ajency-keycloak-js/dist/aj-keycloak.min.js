!function(e){"use strict";if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var t="undefined"!=typeof window?window:self,n=t.Q;t.Q=e(),t.Q.noConflict=function(){return t.Q=n,this}}}(function(){"use strict";var c=!1;try{throw new Error}catch(e){c=!!e.stack}var o,i=b(),t=function(){},f=function(){var n={task:void 0,next:null},t=n,r=!1,o=void 0,i=!1,s=[];function c(){for(var e,t;n.next;)e=(n=n.next).task,n.task=void 0,(t=n.domain)&&(n.domain=void 0,t.enter()),a(e,t);for(;s.length;)a(e=s.pop());r=!1}function a(e,t){try{e()}catch(e){if(i)throw t&&t.exit(),setTimeout(c,0),t&&t.enter(),e;setTimeout(function(){throw e},0)}t&&t.exit()}if(f=function(e){t=t.next={task:e,domain:i&&process.domain,next:null},r||(r=!0,o())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)i=!0,o=function(){process.nextTick(c)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,c):function(){setImmediate(c)};else if("undefined"!=typeof MessageChannel){var e=new MessageChannel;e.port1.onmessage=function(){o=u,(e.port1.onmessage=c)()};var u=function(){e.port2.postMessage(0)};o=function(){setTimeout(c,0),u()}}else o=function(){setTimeout(c,0)};return f.runAfter=function(e){s.push(e),r||(r=!0,o())},f}(),n=Function.call;function e(e){return function(){return n.apply(e,arguments)}}var a,u=e(Array.prototype.slice),l=e(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),s=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),r=e(Array.prototype.map||function(r,o){var i=this,s=[];return l(i,function(e,t,n){s.push(r.call(o,t,n,i))},void 0),s}),p=Object.create||function(e){function t(){}return t.prototype=e,new t},d=Object.defineProperty||function(e,t,n){return e[t]=n.value,e},h=e(Object.prototype.hasOwnProperty),m=Object.keys||function(e){var t=[];for(var n in e)h(e,n)&&t.push(n);return t},v=e(Object.prototype.toString);a="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var y="From previous event:";function k(e,t){if(c&&t.stack&&"object"==typeof e&&null!==e&&e.stack){for(var n=[],r=t;r;r=r.source)r.stack&&(!e.__minimumStackCounter__||e.__minimumStackCounter__>r.stackCounter)&&(d(e,"__minimumStackCounter__",{value:r.stackCounter,configurable:!0}),n.unshift(r.stack));n.unshift(e.stack);var o=function(e){for(var t=e.split("\n"),n=[],r=0;r<t.length;++r){var o=t[r];!w(o)&&(-1===(i=o).indexOf("(module.js:")&&-1===i.indexOf("(node.js:"))&&o&&n.push(o)}var i;return n.join("\n")}(n.join("\n"+y+"\n"));d(e,"stack",{value:o,configurable:!0})}}function g(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function w(e){var t=g(e);if(!t)return!1;var n=t[0],r=t[1];return n===o&&i<=r&&r<=G}function b(){if(c)try{throw new Error}catch(e){var t=e.stack.split("\n"),n=g(0<t[0].indexOf("@")?t[1]:t[2]);if(!n)return;return o=n[0],n[1]}}function S(e){return e instanceof _?e:A(e)?(t=e,n=j(),S.nextTick(function(){try{t.then(n.resolve,n.reject,n.notify)}catch(e){n.reject(e)}}),n.promise):K(e);var t,n}(S.resolve=S).nextTick=f,S.longStackSupport=!1;var T=1;function j(){var o,i=[],s=[],e=p(j.prototype),t=p(_.prototype);if(t.promiseDispatch=function(e,t,n){var r=u(arguments);i?(i.push(r),"when"===t&&n[1]&&s.push(n[1])):S.nextTick(function(){o.promiseDispatch.apply(o,r)})},t.valueOf=function(){if(i)return t;var e=O(o);return E(e)&&(o=e),e},t.inspect=function(){return o?o.inspect():{state:"pending"}},S.longStackSupport&&c)try{throw new Error}catch(e){t.stack=e.stack.substring(e.stack.indexOf("\n")+1),t.stackCounter=T++}function n(n){o=n,S.longStackSupport&&c&&(t.source=n),l(i,function(e,t){S.nextTick(function(){n.promiseDispatch.apply(n,t)})},void 0),s=i=void 0}return e.promise=t,e.resolve=function(e){o||n(S(e))},e.fulfill=function(e){o||n(K(e))},e.reject=function(e){o||n(D(e))},e.notify=function(n){o||l(s,function(e,t){S.nextTick(function(){t(n)})},void 0)},e}function R(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=j();try{e(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise}function I(o){return R(function(e,t){for(var n=0,r=o.length;n<r;n++)S(o[n]).then(e,t)})}function _(o,i,t){void 0===i&&(i=function(e){return D(new Error("Promise does not support operation: "+e))}),void 0===t&&(t=function(){return{state:"unknown"}});var s=p(_.prototype);if(s.promiseDispatch=function(e,t,n){var r;try{r=o[t]?o[t].apply(s,n):i.call(s,t,n)}catch(e){r=D(e)}e&&e(r)},s.inspect=t){var e=t();"rejected"===e.state&&(s.exception=e.reason),s.valueOf=function(){var e=t();return"pending"===e.state||"rejected"===e.state?s:e.value}}return s}function x(e,t,n,r){return S(e).then(t,n,r)}function O(e){if(E(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function E(e){return e instanceof _}function A(e){return(t=e)===Object(t)&&"function"==typeof e.then;var t}"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(S.longStackSupport=!0),(S.defer=j).prototype.makeNodeResolver=function(){var n=this;return function(e,t){e?n.reject(e):2<arguments.length?n.resolve(u(arguments,1)):n.resolve(t)}},S.Promise=R,(S.promise=R).race=I,R.all=Q,R.reject=D,(R.resolve=S).passByCopy=function(e){return e},_.prototype.passByCopy=function(){return this},S.join=function(e,t){return S(e).join(t)},_.prototype.join=function(e){return S([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Q can't join: not the same: "+e+" "+t)})},S.race=I,_.prototype.race=function(){return this.then(S.race)},(S.makePromise=_).prototype.toString=function(){return"[object Promise]"},_.prototype.then=function(t,n,o){var r=this,i=j(),s=!1;return S.nextTick(function(){r.promiseDispatch(function(e){s||(s=!0,i.resolve(function(e){try{return"function"==typeof t?t(e):e}catch(e){return D(e)}}(e)))},"when",[function(e){s||(s=!0,i.resolve(function(e){if("function"==typeof n){k(e,r);try{return n(e)}catch(e){return D(e)}}return D(e)}(e)))}])}),r.promiseDispatch(void 0,"when",[void 0,function(e){var t,n,r=!1;try{n=e,t="function"==typeof o?o(n):n}catch(e){if(r=!0,!S.onerror)throw e;S.onerror(e)}r||i.notify(t)}]),i.promise},S.tap=function(e,t){return S(e).tap(t)},_.prototype.tap=function(t){return t=S(t),this.then(function(e){return t.fcall(e).thenResolve(e)})},S.when=x,_.prototype.thenResolve=function(e){return this.then(function(){return e})},S.thenResolve=function(e,t){return S(e).thenResolve(t)},_.prototype.thenReject=function(e){return this.then(function(){throw e})},S.thenReject=function(e,t){return S(e).thenReject(t)},S.nearer=O,S.isPromise=E,S.isPromiseAlike=A,S.isPending=function(e){return E(e)&&"pending"===e.inspect().state},_.prototype.isPending=function(){return"pending"===this.inspect().state},S.isFulfilled=function(e){return!E(e)||"fulfilled"===e.inspect().state},_.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},S.isRejected=function(e){return E(e)&&"rejected"===e.inspect().state},_.prototype.isRejected=function(){return"rejected"===this.inspect().state};var C,U,P,L=[],N=[],M=[],H=!0;function q(){L.length=0,N.length=0,H||(H=!0)}function D(t){var e,n,r=_({when:function(e){return e&&function(t){if(H){var n=s(N,t);-1!==n&&("object"==typeof process&&"function"==typeof process.emit&&S.nextTick.runAfter(function(){var e=s(M,t);-1!==e&&(process.emit("rejectionHandled",L[n],t),M.splice(e,1))}),N.splice(n,1),L.splice(n,1))}}(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return e=r,n=t,H&&("object"==typeof process&&"function"==typeof process.emit&&S.nextTick.runAfter(function(){-1!==s(N,e)&&(process.emit("unhandledRejection",n,e),M.push(e))}),N.push(e),n&&void 0!==n.stack?L.push(n.stack):L.push("(no stack) "+n)),r}function K(n){return _({when:function(){return n},get:function(e){return n[e]},set:function(e,t){n[e]=t},delete:function(e){delete n[e]},post:function(e,t){return null==e?n.apply(void 0,t):n[e].apply(n,t)},apply:function(e,t){return n.apply(e,t)},keys:function(){return m(n)}},void 0,function(){return{state:"fulfilled",value:n}})}function z(e,t,n){return S(e).spread(t,n)}function J(e,t,n){return S(e).dispatch(t,n)}function Q(e){return x(e,function(o){var i=0,s=j();return l(o,function(e,t,n){var r;E(t)&&"fulfilled"===(r=t.inspect()).state?o[n]=r.value:(++i,x(t,function(e){o[n]=e,0==--i&&s.resolve(o)},s.reject,function(e){s.notify({index:n,value:e})}))},void 0),0===i&&s.resolve(o),s.promise})}function B(o){if(0===o.length)return S.resolve();var i=S.defer(),s=0;return l(o,function(e,t,n){var r=o[n];s++,x(r,function(e){i.resolve(e)},function(e){if(0==--s){var t=e||new Error(""+e);t.message="Q can't get fulfillment value from any promise, all promises were rejected. Last error message: "+t.message,i.reject(t)}},function(e){i.notify({index:n,value:e})})},void 0),i.promise}function F(e){return x(e,function(e){return e=r(e,S),x(Q(r(e,function(e){return x(e,t,t)})),function(){return e})})}S.resetUnhandledRejections=q,S.getUnhandledReasons=function(){return L.slice()},S.stopUnhandledRejectionTracking=function(){q(),H=!1},q(),S.reject=D,S.fulfill=K,S.master=function(n){return _({isDef:function(){}},function(e,t){return J(n,e,t)},function(){return S(n).inspect()})},S.spread=z,_.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},S.async=function(t){return function(){function e(e,t){var n,r;if("undefined"==typeof StopIteration){try{n=o[e](t)}catch(e){return D(e)}return n.done?S(n.value):x(n.value,i,s)}try{n=o[e](t)}catch(e){return"[object StopIteration]"===v(r=e)||r instanceof a?S(e.value):D(e)}return x(n,i,s)}var o=t.apply(this,arguments),i=e.bind(e,"next"),s=e.bind(e,"throw");return i()}},S.spawn=function(e){S.done(S.async(e)())},S.return=function(e){throw new a(e)},S.promised=function(n){return function(){return z([this,Q(arguments)],function(e,t){return n.apply(e,t)})}},S.dispatch=J,_.prototype.dispatch=function(e,t){var n=this,r=j();return S.nextTick(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},S.get=function(e,t){return S(e).dispatch("get",[t])},_.prototype.get=function(e){return this.dispatch("get",[e])},S.set=function(e,t,n){return S(e).dispatch("set",[t,n])},_.prototype.set=function(e,t){return this.dispatch("set",[e,t])},S.del=S.delete=function(e,t){return S(e).dispatch("delete",[t])},_.prototype.del=_.prototype.delete=function(e){return this.dispatch("delete",[e])},S.mapply=S.post=function(e,t,n){return S(e).dispatch("post",[t,n])},_.prototype.mapply=_.prototype.post=function(e,t){return this.dispatch("post",[e,t])},S.send=S.mcall=S.invoke=function(e,t){return S(e).dispatch("post",[t,u(arguments,2)])},_.prototype.send=_.prototype.mcall=_.prototype.invoke=function(e){return this.dispatch("post",[e,u(arguments,1)])},S.fapply=function(e,t){return S(e).dispatch("apply",[void 0,t])},_.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},S.try=S.fcall=function(e){return S(e).dispatch("apply",[void 0,u(arguments,1)])},_.prototype.fcall=function(){return this.dispatch("apply",[void 0,u(arguments)])},S.fbind=function(e){var t=S(e),n=u(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(u(arguments))])}},_.prototype.fbind=function(){var e=this,t=u(arguments);return function(){return e.dispatch("apply",[this,t.concat(u(arguments))])}},S.keys=function(e){return S(e).dispatch("keys",[])},_.prototype.keys=function(){return this.dispatch("keys",[])},S.all=Q,_.prototype.all=function(){return Q(this)},S.any=B,_.prototype.any=function(){return B(this)},S.allResolved=(C=F,U="allResolved",P="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(U+" is deprecated, use "+P+" instead.",new Error("").stack),C.apply(C,arguments)}),_.prototype.allResolved=function(){return F(this)},S.allSettled=function(e){return S(e).allSettled()},_.prototype.allSettled=function(){return this.then(function(e){return Q(r(e,function(e){function t(){return e.inspect()}return(e=S(e)).then(t,t)}))})},S.fail=S.catch=function(e,t){return S(e).then(void 0,t)},_.prototype.fail=_.prototype.catch=function(e){return this.then(void 0,e)},S.progress=function(e,t){return S(e).then(void 0,void 0,t)},_.prototype.progress=function(e){return this.then(void 0,void 0,e)},S.fin=S.finally=function(e,t){return S(e).finally(t)},_.prototype.fin=_.prototype.finally=function(t){if(!t||"function"!=typeof t.apply)throw new Error("Q can't apply finally callback");return t=S(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},S.done=function(e,t,n,r){return S(e).done(t,n,r)},_.prototype.done=function(e,t,n){var r=function(e){S.nextTick(function(){if(k(e,o),!S.onerror)throw e;S.onerror(e)})},o=e||t||n?this.then(e,t,n):this;"object"==typeof process&&process&&process.domain&&(r=process.domain.bind(r)),o.then(void 0,r)},S.timeout=function(e,t,n){return S(e).timeout(t,n)},_.prototype.timeout=function(e,t){var n=j(),r=setTimeout(function(){t&&"string"!=typeof t||((t=new Error(t||"Timed out after "+e+" ms")).code="ETIMEDOUT"),n.reject(t)},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},S.delay=function(e,t){return void 0===t&&(t=e,e=void 0),S(e).delay(t)},_.prototype.delay=function(n){return this.then(function(e){var t=j();return setTimeout(function(){t.resolve(e)},n),t.promise})},S.nfapply=function(e,t){return S(e).nfapply(t)},_.prototype.nfapply=function(e){var t=j(),n=u(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},S.nfcall=function(e){var t=u(arguments,1);return S(e).nfapply(t)},_.prototype.nfcall=function(){var e=u(arguments),t=j();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},S.nfbind=S.denodeify=function(n){if(void 0===n)throw new Error("Q can't wrap an undefined function");var r=u(arguments,1);return function(){var e=r.concat(u(arguments)),t=j();return e.push(t.makeNodeResolver()),S(n).fapply(e).fail(t.reject),t.promise}},_.prototype.nfbind=_.prototype.denodeify=function(){var e=u(arguments);return e.unshift(this),S.denodeify.apply(void 0,e)},S.nbind=function(n,r){var o=u(arguments,2);return function(){var e=o.concat(u(arguments)),t=j();return e.push(t.makeNodeResolver()),S(function(){return n.apply(r,arguments)}).fapply(e).fail(t.reject),t.promise}},_.prototype.nbind=function(){var e=u(arguments,0);return e.unshift(this),S.nbind.apply(void 0,e)},S.nmapply=S.npost=function(e,t,n){return S(e).npost(t,n)},_.prototype.nmapply=_.prototype.npost=function(e,t){var n=u(t||[]),r=j();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},S.nsend=S.nmcall=S.ninvoke=function(e,t){var n=u(arguments,2),r=j();return n.push(r.makeNodeResolver()),S(e).dispatch("post",[t,n]).fail(r.reject),r.promise},_.prototype.nsend=_.prototype.nmcall=_.prototype.ninvoke=function(e){var t=u(arguments,1),n=j();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},S.nodeify=function(e,t){return S(e).nodeify(t)},_.prototype.nodeify=function(t){if(!t)return this;this.then(function(e){S.nextTick(function(){t(null,e)})},function(e){S.nextTick(function(){t(e)})})},S.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var G=b();return S}),function(I,r){var n=function(u){if(!(this instanceof n))return new n(u);for(var a,f,l=this,c=[],p={enable:!0,callbackList:[],interval:5},e=document.getElementsByTagName("script"),t=0;t<e.length;t++)-1===e[t].src.indexOf("keycloak.js")&&-1===e[t].src.indexOf("keycloak.min.js")||-1===e[t].src.indexOf("version=")||(l.iframeVersion=e[t].src.substring(e[t].src.indexOf("version=")+8).split("&")[0]);var d=!0;function h(){return void 0!==l.authServerUrl?"/"==l.authServerUrl.charAt(l.authServerUrl.length-1)?l.authServerUrl+"realms/"+encodeURIComponent(l.realm):l.authServerUrl+"/realms/"+encodeURIComponent(l.realm):r}function m(o,i){var e=o.code,t=o.error,n=o.prompt,s=(new Date).getTime();if(t)if("none"!=n){var r={error:t,error_description:o.error_description};l.onAuthError&&l.onAuthError(r),i&&i.setError(r)}else i&&i.setSuccess();else if("standard"!=l.flow&&(o.access_token||o.id_token)&&f(o.access_token,null,o.id_token,!0),"implicit"!=l.flow&&e){var c="code="+e+"&grant_type=authorization_code",a=l.endpoints.token(),u=new XMLHttpRequest;u.open("POST",a,!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.clientId&&l.clientSecret?u.setRequestHeader("Authorization","Basic "+btoa(l.clientId+":"+l.clientSecret)):c+="&client_id="+encodeURIComponent(l.clientId),c+="&redirect_uri="+o.redirectUri,u.withCredentials=!0,u.onreadystatechange=function(){if(4==u.readyState)if(200==u.status){var e=JSON.parse(u.responseText);f(e.access_token,e.refresh_token,e.id_token,"standard"===l.flow)}else l.onAuthError&&l.onAuthError(),i&&i.setError()},u.send(c)}function f(e,t,n,r){y(e,t,n,s=(s+(new Date).getTime())/2),d&&(l.tokenParsed&&l.tokenParsed.nonce!=o.storedNonce||l.refreshTokenParsed&&l.refreshTokenParsed.nonce!=o.storedNonce||l.idTokenParsed&&l.idTokenParsed.nonce!=o.storedNonce)?(console.info("[KEYCLOAK] Invalid nonce, clearing token"),l.clearToken(),i&&i.setError()):r&&(l.onAuthSuccess&&l.onAuthSuccess(),i&&i.setSuccess())}}function v(e){return 0==e.status&&e.responseText&&e.responseURL.startsWith("file:")}function y(e,t,n,r){if(l.tokenTimeoutHandle&&(clearTimeout(l.tokenTimeoutHandle),l.tokenTimeoutHandle=null),t?(l.refreshToken=t,l.refreshTokenParsed=i(t)):(delete l.refreshToken,delete l.refreshTokenParsed),n?(l.idToken=n,l.idTokenParsed=i(n)):(delete l.idToken,delete l.idTokenParsed),e){if(l.token=e,l.tokenParsed=i(e),l.sessionId=l.tokenParsed.session_state,l.authenticated=!0,l.subject=l.tokenParsed.sub,l.realmAccess=l.tokenParsed.realm_access,l.resourceAccess=l.tokenParsed.resource_access,r&&(l.timeSkew=Math.floor(r/1e3)-l.tokenParsed.iat),null!=l.timeSkew&&(console.info("[KEYCLOAK] Estimated time difference between browser and server is "+l.timeSkew+" seconds"),l.onTokenExpired)){var o=1e3*(l.tokenParsed.exp-(new Date).getTime()/1e3+l.timeSkew);console.info("[KEYCLOAK] Token expires in "+Math.round(o/1e3)+" s"),o<=0?l.onTokenExpired():l.tokenTimeoutHandle=setTimeout(l.onTokenExpired,o)}}else delete l.token,delete l.tokenParsed,delete l.subject,delete l.realmAccess,delete l.resourceAccess,l.authenticated=!1}function i(e){switch((e=(e=(e=e.split(".")[1]).replace("/-/g","+")).replace("/_/g","/")).length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Invalid token"}return e=(e=(e+"===").slice(0,e.length+e.length%4)).replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(escape(atob(e))),e=JSON.parse(e)}function k(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function g(e){var t=function(e){var t;switch(l.flow){case"standard":t=["code","state","session_state"];break;case"implicit":t=["access_token","id_token","state","session_state"];break;case"hybrid":t=["access_token","id_token","code","state","session_state"]}t.push("error"),t.push("error_description"),t.push("error_uri");var n,r,o=e.indexOf("?"),i=e.indexOf("#");"query"===l.responseMode&&-1!==o?(n=e.substring(0,o),""!==(r=s(e.substring(o+1,-1!==i?i:e.length),t)).paramsString&&(n+="?"+r.paramsString),-1!==i&&(n+=e.substring(i))):"fragment"===l.responseMode&&-1!==i&&(n=e.substring(0,i),""!==(r=s(e.substring(i+1),t)).paramsString&&(n+="#"+r.paramsString));if(r&&r.oauthParams)if("standard"===l.flow||"hybrid"===l.flow){if((r.oauthParams.code||r.oauthParams.error)&&r.oauthParams.state)return r.oauthParams.newUrl=n,r.oauthParams}else if("implicit"===l.flow&&(r.oauthParams.access_token||r.oauthParams.error)&&r.oauthParams.state)return r.oauthParams.newUrl=n,r.oauthParams}(e);if(t){var n=f.get(t.state);return n&&(t.valid=!0,t.redirectUri=n.redirectUri,t.storedNonce=n.nonce,t.prompt=n.prompt),t}}function s(e,t){for(var n=e.split("&"),r={paramsString:"",oauthParams:{}},o=0;o<n.length;o++){var i=n[o].split("=");-1!==t.indexOf(i[0])?r.oauthParams[i[0]]=i[1]:(""!==r.paramsString&&(r.paramsString+="&"),r.paramsString+=n[o])}return r}function w(){return"function"==typeof Promise?((n={setSuccess:function(e){n.success=!0,n.resolve(e)},setError:function(e){n.success=!1,n.reject(e)}}).promise=new Promise(function(e,t){n.resolve=e,n.reject=t}),n.promise.success=function(e){return n.promise.then(e),n.promise},n.promise.error=function(e){return n.promise.catch(e),n.promise},n):t={setSuccess:function(e){t.success=!0,t.result=e,t.successCallback&&t.successCallback(e)},setError:function(e){t.error=!0,t.result=e,t.errorCallback&&t.errorCallback(e)},promise:{success:function(e){return t.success?e(t.result):t.error||(t.successCallback=e),t.promise},error:function(e){return t.error?e(t.result):t.success||(t.errorCallback=e),t.promise}}};var t,n}function b(){var t=w();if(!p.enable)return t.setSuccess(),t.promise;if(p.iframe)return t.setSuccess(),t.promise;var e=document.createElement("iframe");(p.iframe=e).onload=function(){var e=l.endpoints.authorize();"/"===e.charAt(0)?p.iframeOrigin=I.location.origin?I.location.origin:I.location.protocol+"//"+I.location.hostname+(I.location.port?":"+I.location.port:""):p.iframeOrigin=e.substring(0,e.indexOf("/",8)),t.setSuccess(),setTimeout(r,1e3*p.interval)};var n=l.endpoints.checkSessionIframe();e.setAttribute("src",n),e.setAttribute("title","keycloak-session-iframe"),e.style.display="none",document.body.appendChild(e);I.addEventListener("message",function(e){if(e.origin===p.iframeOrigin&&p.iframe.contentWindow===e.source&&("unchanged"==e.data||"changed"==e.data||"error"==e.data)){"unchanged"!=e.data&&l.clearToken();for(var t=p.callbackList.splice(0,p.callbackList.length),n=t.length-1;0<=n;--n){var r=t[n];"unchanged"==e.data?r.setSuccess():r.setError()}}},!1);var r=function(){S(),l.token&&setTimeout(r,1e3*p.interval)};return t.promise}function S(){var e=w();if(p.iframe&&p.iframeOrigin){var t=l.clientId+" "+l.sessionId;p.callbackList.push(e);var n=p.iframeOrigin;1==p.callbackList.length&&p.iframe.contentWindow.postMessage(t,n)}else e.setSuccess();return e.promise}function T(e){if(!e||"default"==e)return{login:function(e){return I.location.href=l.createLoginUrl(e),w().promise},logout:function(e){return I.location.href=l.createLogoutUrl(e),w().promise},register:function(e){return I.location.href=l.createRegisterUrl(e),w().promise},accountManagement:function(){var e=l.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";return I.location.href=e,w().promise},redirectUri:function(e,t){return 1==arguments.length&&!0,e&&e.redirectUri?e.redirectUri:l.redirectUri?l.redirectUri:location.href}};if("cordova"==e){p.enable=!1;var s=function(e,t,n){return I.cordova&&I.cordova.InAppBrowser?I.cordova.InAppBrowser.open(e,t,n):I.open(e,t,n)};return{login:function(e){var t=w(),n="location=no";e&&"none"==e.prompt&&(n+=",hidden=yes");var r=l.createLoginUrl(e),o=s(r,"_blank",n),i=!1;return o.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&(m(g(e.url),t),o.close(),i=!0)}),o.addEventListener("loaderror",function(e){i||(0==e.url.indexOf("http://localhost")?(m(g(e.url),t),o.close(),i=!0):(t.setError(),o.close()))}),t.promise},logout:function(e){var t,n=w(),r=l.createLogoutUrl(e),o=s(r,"_blank","location=no,hidden=yes");return o.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&o.close()}),o.addEventListener("loaderror",function(e){0==e.url.indexOf("http://localhost")||(t=!0),o.close()}),o.addEventListener("exit",function(e){t?n.setError():(l.clearToken(),n.setSuccess())}),n.promise},register:function(){var e=l.createRegisterUrl(),t=s(e,"_blank","location=no");t.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&t.close()})},accountManagement:function(){var e=l.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";var t=s(e,"_blank","location=no");t.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&t.close()})},redirectUri:function(e){return"http://localhost"}}}throw"invalid adapter type: "+e}l.init=function(n){if(l.authenticated=!1,f=function(){try{return new j}catch(e){}return new R}(),a=n&&"cordova"===n.adapter?T("cordova"):n&&"default"===n.adapter?T():I.Cordova||I.cordova?T("cordova"):T(),n){if(void 0!==n.useNonce&&(d=n.useNonce),void 0!==n.checkLoginIframe&&(p.enable=n.checkLoginIframe),n.checkLoginIframeInterval&&(p.interval=n.checkLoginIframeInterval),"login-required"===n.onLoad&&(l.loginRequired=!0),n.responseMode){if("query"!==n.responseMode&&"fragment"!==n.responseMode)throw"Invalid value for responseMode";l.responseMode=n.responseMode}if(n.flow){switch(n.flow){case"standard":l.responseType="code";break;case"implicit":l.responseType="id_token token";break;case"hybrid":l.responseType="code id_token token";break;default:throw"Invalid value for flow"}l.flow=n.flow}null!=n.timeSkew&&(l.timeSkew=n.timeSkew)}l.responseMode||(l.responseMode="fragment"),l.responseType||(l.responseType="code",l.flow="standard");var t=w(),r=w();r.promise.success(function(){l.onReady&&l.onReady(l.authenticated),t.setSuccess(l.authenticated)}).error(function(e){t.setError(e)});var e=function(e){var t,n=w();u?"string"==typeof u&&(t=u):t="keycloak.json";function r(e){l.endpoints=e?{authorize:function(){return e.authorization_endpoint},token:function(){return e.token_endpoint},logout:function(){if(!e.end_session_endpoint)throw"Not supported by the OIDC server";return e.end_session_endpoint},checkSessionIframe:function(){if(!e.check_session_iframe)throw"Not supported by the OIDC server";return e.check_session_iframe},register:function(){throw'Redirection to "Register user" page not supported in standard OIDC mode'},userinfo:function(){if(!e.userinfo_endpoint)throw"Not supported by the OIDC server";return e.userinfo_endpoint}}:{authorize:function(){return h()+"/protocol/openid-connect/auth"},token:function(){return h()+"/protocol/openid-connect/token"},logout:function(){return h()+"/protocol/openid-connect/logout"},checkSessionIframe:function(){var e=h()+"/protocol/openid-connect/login-status-iframe.html";return l.iframeVersion&&(e=e+"?version="+l.iframeVersion),e},register:function(){return h()+"/protocol/openid-connect/registrations"},userinfo:function(){return h()+"/protocol/openid-connect/userinfo"}}}if(t){var o=new XMLHttpRequest;o.open("GET",t,!0),o.setRequestHeader("Accept","application/json"),o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status||v(o)){var e=JSON.parse(o.responseText);l.authServerUrl=e["auth-server-url"],l.realm=e.realm,l.clientId=e.resource,l.clientSecret=(e.credentials||{}).secret,r(null),n.setSuccess()}else n.setError()},o.send()}else{if(!u.clientId)throw"clientId missing";l.clientId=u.clientId,l.clientSecret=(u.credentials||{}).secret;var i=u.oidcProvider;if(i)if("string"==typeof i){var s;s="/"==i.charAt(i.length-1)?i+".well-known/openid-configuration":i+"/.well-known/openid-configuration";var o=new XMLHttpRequest;o.open("GET",s,!0),o.setRequestHeader("Accept","application/json"),o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status||v(o)){var e=JSON.parse(o.responseText);r(e),n.setSuccess()}else n.setError()},o.send()}else r(i),n.setSuccess();else{if(!u.url)for(var c=document.getElementsByTagName("script"),a=0;a<c.length;a++)if(c[a].src.match(/.*keycloak\.js/)){u.url=c[a].src.substr(0,c[a].src.indexOf("/js/keycloak.js"));break}if(!u.realm)throw"realm missing";l.authServerUrl=u.url,l.realm=u.realm,r(null),n.setSuccess()}}return n.promise}();function o(){var e=function(e){e||(t.prompt="none"),l.login(t).success(function(){r.setSuccess()}).error(function(){r.setError()})},t={};switch(n.onLoad){case"check-sso":p.enable?b().success(function(){S().success(function(){e(!1)}).error(function(){r.setSuccess()})}):e(!1);break;case"login-required":e(!0);break;default:throw"Invalid value for onLoad"}}return e.success(function(){var e=g(I.location.href);if(e&&I.history.replaceState({},null,e.newUrl),e&&e.valid)return b().success(function(){m(e,r)}).error(function(e){r.setError()});n?n.token&&n.refreshToken?(y(n.token,n.refreshToken,n.idToken),p.enable?b().success(function(){S().success(function(){l.onAuthSuccess&&l.onAuthSuccess(),r.setSuccess()}).error(function(){y(null,null,null),r.setSuccess()})}):l.updateToken(-1).success(function(){l.onAuthSuccess&&l.onAuthSuccess(),r.setSuccess()}).error(function(){l.onAuthError&&l.onAuthError(),n.onLoad?o():r.setError()})):n.onLoad?o():r.setSuccess():r.setSuccess()}),e.error(function(){t.setError()}),t.promise},l.login=function(e){return a.login(e)},l.createLoginUrl=function(e){var t,n=k(),r=k(),o=a.redirectUri(e),i={state:n,nonce:r,redirectUri:encodeURIComponent(o)};e&&e.prompt&&(i.prompt=e.prompt),f.add(i),t=e&&"register"==e.action?l.endpoints.register():l.endpoints.authorize();var s=e&&e.scope?"openid "+e.scope:"openid",c=t+"?client_id="+encodeURIComponent(l.clientId)+"&redirect_uri="+encodeURIComponent(o)+"&state="+encodeURIComponent(n)+"&response_mode="+encodeURIComponent(l.responseMode)+"&response_type="+encodeURIComponent(l.responseType)+"&scope="+encodeURIComponent(s);return d&&(c=c+"&nonce="+encodeURIComponent(r)),e&&e.prompt&&(c+="&prompt="+encodeURIComponent(e.prompt)),e&&e.maxAge&&(c+="&max_age="+encodeURIComponent(e.maxAge)),e&&e.loginHint&&(c+="&login_hint="+encodeURIComponent(e.loginHint)),e&&e.idpHint&&(c+="&kc_idp_hint="+encodeURIComponent(e.idpHint)),e&&e.locale&&(c+="&ui_locales="+encodeURIComponent(e.locale)),c},l.logout=function(e){return a.logout(e)},l.createLogoutUrl=function(e){return l.endpoints.logout()+"?redirect_uri="+encodeURIComponent(a.redirectUri(e,!1))},l.register=function(e){return a.register(e)},l.createRegisterUrl=function(e){return e||(e={}),e.action="register",l.createLoginUrl(e)},l.createAccountUrl=function(e){var t=h(),n=r;return void 0!==t&&(n=t+"/account?referrer="+encodeURIComponent(l.clientId)+"&referrer_uri="+encodeURIComponent(a.redirectUri(e))),n},l.accountManagement=function(){return a.accountManagement()},l.hasRealmRole=function(e){var t=l.realmAccess;return!!t&&0<=t.roles.indexOf(e)},l.hasResourceRole=function(e,t){if(!l.resourceAccess)return!1;var n=l.resourceAccess[t||l.clientId];return!!n&&0<=n.roles.indexOf(e)},l.loadUserProfile=function(){var e=h()+"/account",t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Authorization","bearer "+l.token);var n=w();return t.onreadystatechange=function(){4==t.readyState&&(200==t.status?(l.profile=JSON.parse(t.responseText),n.setSuccess(l.profile)):n.setError())},t.send(),n.promise},l.loadUserInfo=function(){var e=l.endpoints.userinfo(),t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Authorization","bearer "+l.token);var n=w();return t.onreadystatechange=function(){4==t.readyState&&(200==t.status?(l.userInfo=JSON.parse(t.responseText),n.setSuccess(l.userInfo)):n.setError())},t.send(),n.promise},l.isTokenExpired=function(e){if(!l.tokenParsed||!l.refreshToken&&"implicit"!=l.flow)throw"Not authenticated";if(null==l.timeSkew)return console.info("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var t=l.tokenParsed.exp-Math.ceil((new Date).getTime()/1e3)+l.timeSkew;return e&&(t-=e),t<0},l.updateToken=function(i){var s=w();if(!l.refreshToken)return s.setError(),s.promise;i=i||5;var e=function(){var e=!1;if(-1==i?(e=!0,console.info("[KEYCLOAK] Refreshing token: forced refresh")):l.tokenParsed&&!l.isTokenExpired(i)||(e=!0,console.info("[KEYCLOAK] Refreshing token: token expired")),e){var t="grant_type=refresh_token&refresh_token="+l.refreshToken,n=l.endpoints.token();if(c.push(s),1==c.length){var r=new XMLHttpRequest;r.open("POST",n,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.withCredentials=!0,l.clientId&&l.clientSecret?r.setRequestHeader("Authorization","Basic "+btoa(l.clientId+":"+l.clientSecret)):t+="&client_id="+encodeURIComponent(l.clientId);var o=(new Date).getTime();r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){console.info("[KEYCLOAK] Token refreshed"),o=(o+(new Date).getTime())/2;var e=JSON.parse(r.responseText);y(e.access_token,e.refresh_token,e.id_token,o),l.onAuthRefreshSuccess&&l.onAuthRefreshSuccess();for(var t=c.pop();null!=t;t=c.pop())t.setSuccess(!0)}else{console.warn("[KEYCLOAK] Failed to refresh token"),l.onAuthRefreshError&&l.onAuthRefreshError();for(t=c.pop();null!=t;t=c.pop())t.setError(!0)}},r.send(t)}}else s.setSuccess(!1)};p.enable?S().success(function(){e()}).error(function(){s.setError()}):e();return s.promise},l.clearToken=function(){l.token&&(y(null,null,null),l.onAuthLogout&&l.onAuthLogout(),l.loginRequired&&l.login())},l.callback_id=0;var j=function(){if(!(this instanceof j))return new j;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");function r(){for(var e=(new Date).getTime(),t=0;t<localStorage.length;t++){var n=localStorage.key(t);if(n&&0==n.indexOf("kc-callback-")){var r=localStorage.getItem(n);if(r)try{var o=JSON.parse(r).expires;(!o||o<e)&&localStorage.removeItem(n)}catch(e){localStorage.removeItem(n)}}}}this.get=function(e){if(e){var t="kc-callback-"+e,n=localStorage.getItem(t);return n&&(localStorage.removeItem(t),n=JSON.parse(n)),r(),n}},this.add=function(e){r();var t="kc-callback-"+e.state;e.expires=(new Date).getTime()+36e5,localStorage.setItem(t,JSON.stringify(e))}},R=function(){if(!(this instanceof R))return new R;this.get=function(e){if(e){var t=r("kc-callback-"+e);return o("kc-callback-"+e,"",n(-100)),t?JSON.parse(t):void 0}},this.add=function(e){o("kc-callback-"+e.state,JSON.stringify(e),n(60))},this.removeItem=function(e){o(e,"",n(-100))};var n=function(e){var t=new Date;return t.setTime(t.getTime()+60*e*1e3),t},r=function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""},o=function(e,t,n){var r=e+"="+t+"; expires="+n.toUTCString()+"; ";document.cookie=r}}};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=n:(I.Keycloak=n,"function"==typeof define&&define.amd&&define("keycloak",[],function(){return n}))}(window),function(e){function u(e){return this instanceof u?u.instance?u.instance:void(u.instance=this).initialise(e):new u(e)}u.prototype=function(){function c(e,t,n){"function"==typeof n&&n(e),t.resolve(e)}function a(e,t,n){"function"==typeof n&&n(e),t.reject(e)}return{constructor:u,initialise:function(e){e&&(e["auth-server-url"]&&(e.url=e["auth-server-url"]),e.resource&&(e.clientId=e.resource),u.instance.CONFIG=e,u.instance.keycloak=Keycloak(e))},bootstrap:function(e,n,r){try{u.instance.makeRequest(e).then(function(e){u.instance.initialise(JSON.parse(e));var t=u.instance;t.keycloak.init(n).success(function(){t.keycloak.loadUserInfo().success(function(e){"function"==typeof r?r(t,e):console.warn("invalid bootstrap callback")}).error(function(e){console.warn("user info error: ",e)})}).error(function(e){console.warn("init error:",e)})}).catch(function(e){console.warn("keycloak json error: ",e)})}catch(e){console.warn("bootstrap error: ",e)}},bootstrapAngular:function(i,s){var c,a;angular?i.keycloakjson?i.angularmodule?i.angularmodule.name&&"string"==typeof i.angularmodule.name&&i.angularmodule.instance?(c=i.angularmodule.instance,a=i.angularmodule.name,i.bootstrapnode?!i.runblock||"function"!=typeof i.runblock&&"object"!=typeof i.runblock?console.warn("options is missing runblock callback or has incorrect format"):i.keycloakoptions?u.instance.bootstrap(i.keycloakjson,i.keycloakoptions,function(n,r){if(c.constant("$ajkeycloak",n),c.constant("KEYCLOAKINFO",r),c.service("ajkeycloakservice",["$rootScope","KCuiPermissions",function(e,t){e.ajkeycloak=n,e.KCuiPermissions=t,this.inValidApiAccess=!1,this.instance=n,this.userInfo=r}]),"function"==typeof s&&s(n,r),i.helperservices)for(var e in i.helperservices){var t=i.helperservices[e];if(t.service&&("function"==typeof t.service||"object"==typeof t.service)){var o=t.type;"factory"===o?(c.factory(e,t.service),console.log("factory",e,"added")):"service"===o&&(c.service(e,t.service),console.log("service",e,"added"))}}!i.interceptor||"function"!=typeof i.interceptor&&"object"!=typeof i.interceptor||(c.factory("setKeycloakHeaders",i.interceptor),c.config(function(e){e.interceptors.push("setKeycloakHeaders"),console.log("keycloak interceptor injected")})),angular.bootstrap(i.bootstrapnode,[a]),c.run(i.runblock)}):console.warn("options is missing keycloakoptions"):console.warn("options is missing bootstrapnode property")):console.warn("angularmodule property has incorrect format"):console.warn("options is missing angular module property"):console.warn("missing keycloak json path"):console.warn("angular is not defined")},protect:function(e,n,r){var o=Q.defer();if(u.instance.decoded_rpt=null,e&&e.length){var i={permissions:e};try{u.instance.keycloak.updateToken(5).success(function(e){var t=u.instance.CONFIG.url+"/realms/"+u.instance.CONFIG.realm+"/authz/entitlement/"+u.instance.CONFIG.clientId;u.instance.makeRequest(t,"POST",i,{"Content-Type":"application/json",Authorization:"Bearer "+u.instance.keycloak.token}).then(function(e){var t=JSON.parse(e);t.rpt?(u.instance.decoded_rpt=u.instance.jwtDecode(t.rpt),c(u.instance.decoded_rpt,o,n)):c(t,o,n)}).catch(function(e){a(e,o,r)})}).error(function(e){a(e,o,r)})}catch(e){a(e,o,r)}}else u.instance.keycloak.authenticated?c({},o,n):a({},o,r);return o.promise},makeRequest:function(e,t,n,r){var o=Q.defer(),i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");for(header in i.open(t||"GET",e,!0),r)i.setRequestHeader(header,r[header]);var s="object"==typeof n?JSON.stringify(n):n;return i.onreadystatechange=function(){4==i.readyState&&(200==i.status?c(i.response,o,null):a(i.response,o,null))},i.send("POST"===t?s:""),o.promise},jwtDecode:function(e){if(window&&window.atob){var t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(atob(t))}return console.warn("no base64 decode support"),!1},hasAccess:function(t){var e=u.instance.decoded_rpt;if(t&&t.length){if(e&&e.authorization&&e.authorization.permissions&&e.authorization.permissions.length){var n=e.authorization.permissions,o=!0;return n.map(function(n){var e=t.find(function(e){return e.resource_set_name===n.resource_set_name});if(!e)return o=!1;if(!e.scopes||!n.scopes)return!e.scopes&&!n.scopes||(o=!1);var r=!0;return e.scopes.map(function(t){n.scopes.some(function(e){return t===e})||(r=!1)}),r?void 0:o=r}),o}return!1}return u.instance.keycloak.authenticated}}}(),"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=u:(window.Ajkeycloak=u,"function"==typeof define&&define.amd&&define("Ajkeycloak",[],function(){return u}))}(window);